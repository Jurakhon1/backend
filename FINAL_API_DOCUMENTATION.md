# üéâ –§–ò–ù–ê–õ–¨–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø API

## üì± –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ - Backend API

### ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï**

---

## üîê **–ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø**

### **Auth Endpoints:**

```
POST   /auth/register    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST   /auth/login       - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
POST   /auth/refresh     - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
POST   /auth/logout      - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
```

### **JWT Token Format:**

```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "email": "user@example.com",
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ò–≤–∞–Ω–æ–≤",
    "isVerified": false,
    "languagePreference": "ru"
  }
}
```

### **–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã:**

- üîí **–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã JWT –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
- üîì **–ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–º–µ—á–µ–Ω—ã @Public()**

---

## üìä **API ENDPOINTS**

### üîì **1. –ü—É–±–ª–∏—á–Ω—ã–µ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):**

```
POST   /auth/register           - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST   /auth/login             - –í—Ö–æ–¥
POST   /auth/refresh           - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
GET    /products               - –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
GET    /products/:id           - –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞
GET    /products/slug/:slug    - –ü–æ–∏—Å–∫ –ø–æ slug
GET    /promo                  - –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
```

### üîí **2. –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç JWT):**

#### **üë• Users:**

```
GET    /users                  - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–¥–º–∏–Ω)
GET    /users/:id              - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PUT    /users/:id              - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
DELETE /users/:id              - –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
PUT    /users/:id/change-password - –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
POST   /auth/logout            - –í—ã—Ö–æ–¥
```

#### **üõí Cart (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - –±–µ–∑ userId –≤ URL):**

```
POST   /cart                   - –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
GET    /cart                   - –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
PUT    /cart/items/:itemId     - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
DELETE /cart/items/:itemId     - –£–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
DELETE /cart                   - –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
```

#### **üìã Orders:**

```
POST   /orders/user/:userId             - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
GET    /orders/user/:userId             - –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤
GET    /orders/user/:userId/:orderId    - –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
PUT    /orders/:orderId/confirm-payment - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É
```

#### **üí≥ Payment:**

```
GET    /payment/banks                           - –°–ø–∏—Å–æ–∫ –±–∞–Ω–∫–æ–≤
POST   /payment/transactions                    - –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫
GET    /payment/orders/:orderId/transactions    - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞–∫–∞–∑–∞
PUT    /payment/transactions/:id/confirm        - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (–∞–¥–º–∏–Ω)
PUT    /payment/transactions/:id/reject         - –û—Ç–∫–ª–æ–Ω–∏—Ç—å (–∞–¥–º–∏–Ω)
```

#### **‚ù§Ô∏è Wishlist:**

```
POST   /wishlist/:userId/products/:productId          - –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
DELETE /wishlist/:userId/products/:productId          - –ò–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
GET    /wishlist/:userId                              - –°–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
POST   /wishlist/:userId/comparison/:productId        - –í —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
GET    /wishlist/:userId/comparison                   - –°–ø–∏—Å–æ–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
```

#### **üéÅ Bonus:**

```
GET    /bonus/users/:userId/balance      - –ë–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤
GET    /bonus/users/:userId/transactions - –ò—Å—Ç–æ—Ä–∏—è –±–æ–Ω—É—Å–æ–≤
POST   /bonus/spend                      - –ü–æ—Ç—Ä–∞—Ç–∏—Ç—å –±–æ–Ω—É—Å—ã
POST   /bonus/orders/:orderId/earn       - –ù–∞—á–∏—Å–ª–∏—Ç—å –∑–∞ –∑–∞–∫–∞–∑
```

#### **üè∑Ô∏è Promo:**

```
POST   /promo/validate                   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
POST   /promo/apply                      - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
GET    /promo/users/:userId/usage        - –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

---

## üîÑ **–ë–ò–ó–ù–ï–°-–ü–†–û–¶–ï–°–°–´**

### **1. üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥:**

```
1. POST /auth/register ‚Üí –ø–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω—ã
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å accessToken –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å refreshToken –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

### **2. üõí –†–∞–±–æ—Ç–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π:**

```
1. POST /cart (—Å JWT) ‚Üí –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
2. GET /cart (—Å JWT) ‚Üí –ø–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
3. PUT /cart/items/:id (—Å JWT) ‚Üí –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
```

### **3. üì¶ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:**

```
1. POST /orders/user/:userId ‚Üí —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (10% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞)
2. GET /payment/banks ‚Üí –≤—ã–±—Ä–∞—Ç—å –±–∞–Ω–∫
3. POST /payment/transactions ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫
4. –ê–¥–º–∏–Ω: PUT /payment/transactions/:id/confirm ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
```

### **4. üéÅ –ë–æ–Ω—É—Å—ã:**

```
1. GET /bonus/users/:userId/balance ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å
2. POST /bonus/spend ‚Üí –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å –ø—Ä–∏ –∑–∞–∫–∞–∑–µ
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: POST /bonus/orders/:id/earn ‚Üí –Ω–∞—á–∏—Å–ª–∏—Ç—å 5%
```

---

## üîß **–¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò**

### **JWT Configuration:**

- **Access Token**: 1 —á–∞—Å
- **Refresh Token**: 7 –¥–Ω–µ–π
- **Secret**: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ ENV

### **Database:**

- **synchronize: true** - –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- **SSL: true** - –¥–ª—è Neon DB
- **camelCase** naming –≤ –∫–æ–¥–µ
- **snake_case** –≤ –ë–î

### **Validation:**

- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ ValidationPipes** –≤–∫–ª—é—á–µ–Ω—ã
- **transform: true** - –∞–≤—Ç–æ–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
- **whitelist: true** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–∏—à–Ω–∏—Ö –ø–æ–ª–µ–π

### **CORS:**

- **–í–∫–ª—é—á–µ–Ω** –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **credentials: true** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ cookies

---

## üöÄ **–ó–ê–ü–£–°–ö –ü–†–û–ï–ö–¢–ê**

### **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
cd backend
npm install
```

### **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ENV:**

```env
DB_HOST=ep-wispy-scene-ad9kw2ak-pooler.c-2.us-east-1.aws.neon.tech
DB_USERNAME=neondb_owner
DB_PASSWORD=npg_8wrJUQdLS7vu
DB_DATABASE=neondb
JWT_SECRET=your-super-secret-jwt-key
PORT=3000
```

### **3. –ó–∞–ø—É—Å–∫:**

```bash
npm run start:dev
```

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
curl http://localhost:3000/products
```

---

## üì± **–î–õ–Ø FLUTTER –†–ê–ó–†–ê–ë–û–¢–ß–ò–ö–ê**

### **API Base URL:**

```dart
const String baseUrl = 'http://localhost:3000';
```

### **–ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ä–æ—É—Ç–æ–≤:**

```dart
{
  'Authorization': 'Bearer $accessToken',
  'Content-Type': 'application/json',
}
```

### **–ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**

```dart
POST /auth/register
{
  "email": "user@example.com",
  "password": "password123",
  "firstName": "–ò–≤–∞–Ω",
  "lastName": "–ò–≤–∞–Ω–æ–≤",
  "phone": "+79123456789",
  "languagePreference": "ru"
}
```

### **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–∑–∏–Ω–æ–π:**

```dart
// –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É (—Å JWT)
POST /cart
{
  "product_id": 1,
  "quantity": 2
}

// –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É (—Å JWT)
GET /cart
```

---

## ‚úÖ **–ì–û–¢–û–í–´–ï –§–ò–ß–ò**

- üîê **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —Å refresh —Ç–æ–∫–µ–Ω–∞–º–∏
- üõí **–ö–æ—Ä–∑–∏–Ω–∞** —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ JWT
- üì¶ **–ó–∞–∫–∞–∑—ã —Å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–æ–π 10%** –∏ —Ç–∞–π–º–µ—Ä–æ–º
- üí≥ **–°–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã** —á–µ—Ä–µ–∑ –±–∞–Ω–∫–∏
- üéÅ **–ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** —Å –∞–≤—Ç–æ–Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ–º
- üè∑Ô∏è **–ü—Ä–æ–º–æ–∫–æ–¥—ã** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚ù§Ô∏è **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ**
- üîß **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö
- üìä **camelCase** naming convention

---

**üöÄ Backend –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º!**

_–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã, JWT —Ä–∞–±–æ—Ç–∞–µ—Ç, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞_ ‚ú®
